<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="images/mylogo.png"><title>接口耗时问题排查 | 学渣很忙的博客</title><meta name="description" content="学渣很忙的博客">
    <link rel="preload" href="/blogs/assets/style-Dmi9aAPa.css" as="style"><link rel="stylesheet" href="/blogs/assets/style-Dmi9aAPa.css">
    <link rel="modulepreload" href="/blogs/assets/app-CB8GcC1F.js"><link rel="modulepreload" href="/blogs/assets/接口耗时问题排查.html-Bb99ZaHf.js">
    <link rel="prefetch" href="/blogs/assets/index.html-CbWmYwb7.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Dg3SyGf0.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Dyvjd5yP.js" as="script"><link rel="prefetch" href="/blogs/assets/具体问题列表.html-Flh1QxzS.js" as="script"><link rel="prefetch" href="/blogs/assets/网络连接相关问题排查.html-B1HLz74L.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-C93oWQ59.js" as="script"><link rel="prefetch" href="/blogs/assets/使用VuePress搭建博客.html-WKyq6y8L.js" as="script"><link rel="prefetch" href="/blogs/assets/使用VuePress默认主题.html-CIxF3NMO.js" as="script"><link rel="prefetch" href="/blogs/assets/将博客部署到GitHub Pages.html-DyRlrYJy.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DXZyIO4u.js" as="script"><link rel="prefetch" href="/blogs/assets/笔记01-课程简介.html-DXn22GX6.js" as="script"><link rel="prefetch" href="/blogs/assets/笔记02-BTC-密码学原理.html-CjnkAA9q.js" as="script"><link rel="prefetch" href="/blogs/assets/笔记03-BTC-数据结构.html-CZSfPOZr.js" as="script"><link rel="prefetch" href="/blogs/assets/404.html-DH8l0inO.js" as="script"><link rel="prefetch" href="/blogs/assets/setupDevtools-7MC2TMWH-DNdUJw1E.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-navbar no-sidebar external-link-icon" vp-container><!--[--><!----><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><br><h2 id="接口性能耗时排查" tabindex="-1"><a class="header-anchor" href="#接口性能耗时排查"><span>接口性能耗时排查</span></a></h2><h3 id="_1-使用arthas辅助排查" tabindex="-1"><a class="header-anchor" href="#_1-使用arthas辅助排查"><span>1. 使用Arthas辅助排查</span></a></h3><blockquote><p><code>Arthas</code>的<a href="https://arthas.aliyun.com/" target="_blank" rel="noopener noreferrer">官方文档</a>地址：https://arthas.aliyun.com/</p></blockquote><h4 id="_1-1-下载并启动arthas" tabindex="-1"><a class="header-anchor" href="#_1-1-下载并启动arthas"><span>1.1 下载并启动Arthas</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 下载到当前目录下</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://arthas.aliyun.com/arthas-boot.jar</span>
<span class="line"><span class="token comment"># 启动</span></span>
<span class="line"><span class="token function">java</span> <span class="token parameter variable">-jar</span> arthas-boot.jar</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 等到出现 类似 [1]: 12345 /home/admin/example/demo.jar 这种的列表时，输入[]中的序号后按回车即可监听到目标 Java进程，见到如下命令行即可输入 arthas 的各种命令</span></span>
<span class="line"><span class="token punctuation">[</span>arthas@12345<span class="token punctuation">]</span>$ </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 退出arthas,用完arthas后，输入 stop 后按回车 即可。否则 arthas会在后台继续运行。</span></span>
<span class="line"><span class="token punctuation">[</span>arthas@12345<span class="token punctuation">]</span>$ stop </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>curl</code>参数 <ul><li><code>-O</code>：（大写字母O）使用远程文件的原始名称保存文件。</li><li><code>-o</code>：（小写字母o）可以指定输出文件名，例如<code>curl -o output.txt http://example.com/file.txt</code>。</li></ul></li></ul><h4 id="_1-2-使用trace命令" tabindex="-1"><a class="header-anchor" href="#_1-2-使用trace命令"><span>1.2 使用<code>trace</code>命令</span></a></h4><blockquote><p>使用情况：<strong>明确知道某个方法很慢，但不清楚具体是方法内哪段代码慢。</strong></p></blockquote><ul><li>作用：输出方法内部的每个子方法的耗时。</li><li>注意：每次只能跟踪一级方法的调用链路。</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 根据调用方法耗时过滤,超过200毫秒的打印出来，捕捉10次</span></span>
<span class="line">trace org.redisson.spring.data.connection.RedissonConnection get <span class="token parameter variable">-n</span> <span class="token number">10</span> <span class="token string">&#39;#cost &gt; 200&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>参数解析 <ul><li><code>-n 10</code>：指定捕捉结果的次数，默认<code>100</code>次。</li><li><code>&#39;#cost &gt; 100&#39;</code>：捕捉<code>RedissonConnection类</code>的<code>get方法</code>耗时超过<code>200ms</code>的调用。</li></ul></li><li>结束<code>trace</code>命令 <ul><li>如果收集到足够次数会自动结束本次<code>trace</code>。</li><li>如果要手动结束，按下<code>Q</code>或者<code>Ctrl + C</code>也可以结束本次<code>trace</code>。</li><li>结束本次trace后，输入<code>reset后按回车</code>取消对类和方法的增强，否则影响性能。</li></ul></li></ul><blockquote><p>写笔记时已经没有想要的例子，给出如下结果做分析，体会其过程。</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>arthas@1452252<span class="token punctuation">]</span>$ trace org.redisson.spring.data.connection.RedissonConnection get <span class="token parameter variable">-n</span> <span class="token number">10</span> <span class="token string">&#39;#cost &gt; 2&#39;</span></span>
<span class="line">Press Q or Ctrl+C to abort.</span>
<span class="line">Affect<span class="token punctuation">(</span>class count: <span class="token number">1</span> , method count: <span class="token number">1</span><span class="token punctuation">)</span> cost <span class="token keyword">in</span> <span class="token number">524</span> ms, listenerId: <span class="token number">1</span></span>
<span class="line"><span class="token variable"><span class="token variable">`</span>---ts<span class="token operator">=</span><span class="token number">2024</span>-12-28 <span class="token number">13</span>:11:30.609<span class="token punctuation">;</span><span class="token assign-left variable">thread_name</span><span class="token operator">=</span>http-nio-8090-exec-123<span class="token punctuation">;</span><span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token number">21741</span><span class="token punctuation">;</span><span class="token assign-left variable">is_daemon</span><span class="token operator">=</span>true<span class="token punctuation">;</span><span class="token assign-left variable">priority</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token assign-left variable">TCCL</span><span class="token operator">=</span>org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@503f91c3</span>
<span class="line">    <span class="token variable">`</span></span>---<span class="token punctuation">[</span><span class="token number">4</span>.702433ms<span class="token punctuation">]</span> org.redisson.spring.data.connection.RedissonConnection:get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        `---<span class="token punctuation">[</span><span class="token number">81.17</span>% <span class="token number">3</span>.817142ms <span class="token punctuation">]</span> org.redisson.spring.data.connection.RedissonConnection:read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#484</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>结果分析 <ul><li>一般会把耗时最长的方法标红显示。</li><li>上例可以看到是 <code>RedissonConnection</code>的<code>get</code>方法耗时最长。</li><li>接着就是对耗时最长的方法<code>进行优化</code>或者<code>进一步排查</code>，进一步排查时可以继续使用<code>trace</code>命令找到其子方法的耗时。</li></ul></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新时间: </span><!----></div><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blogs/assets/app-CB8GcC1F.js" defer></script>
  </body>
</html>
